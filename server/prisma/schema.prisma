generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql" // Use your specific database provider
  url      = env("DATABASE_URL")
}

model User {
  id                Int               @id @default(autoincrement())
  name              String
  address           String
  contact_number    String
  email             String            @unique
  date_of_birth     DateTime
  role              String            // e.g., client, admin
  password          String            // Added password field
  insurancePolicies InsurancePolicy[]
  vehicles          Vehicle[]
  claims            Claim[]

  @@map("user")
}

model InsurancePolicy {
  id            Int      @id @default(autoincrement())
  user_id       Int      // Updated to refer to user
  vehicle_id    Int
  policy_number String   @unique @default(cuid())
  type          String
  start_date    DateTime
  end_date      DateTime
  amount        Float
  status        String   // e.g., active, expired, cancelled
  user          User     @relation(fields: [user_id], references: [id]) // Updated
  vehicle       Vehicle  @relation(fields: [vehicle_id], references: [id])

  @@map("insurance_policy")
}

model Vehicle {
  id                Int               @id @default(autoincrement())
  user_id           Int               // Updated to refer to user
  make              String
  model             String
  year              Int
  license_plate     String
  vin_number        String            @unique
  user              User              @relation(fields: [user_id], references: [id]) // Updated
  insurancePolicies InsurancePolicy[]
  accidents         Accident[]        @relation("AccidentVehicle")
  AccidentVehicle   AccidentVehicle[]

  @@map("vehicle")
}

model Accident {
  id              Int               @id @default(autoincrement())
  date            DateTime
  location        String
  description     String
  claims          Claim[]
  vehicles        Vehicle[]         @relation("AccidentVehicle")
  AccidentVehicle AccidentVehicle[]

  @@map("accident")
}

model Claim {
  id             Int      @id @default(autoincrement())
  user_id        Int      // Updated to refer to user
  accident_id    Int
  claim_number   String   @unique
  date_submitted DateTime
  status         String   // e.g., submitted, under review, approved, rejected
  description    String
  amount_claimed Float
  user           User     @relation(fields: [user_id], references: [id]) // Updated
  accident       Accident @relation(fields: [accident_id], references: [id])

  @@map("claim")
}

model AccidentVehicle {
  id          Int         @id @default(autoincrement())
  accident_id Int
  vehicle_id  Int

  accident Accident @relation(fields: [accident_id], references: [id])
  vehicle  Vehicle  @relation(fields: [vehicle_id], references: [id])

  @@map("accident_vehicle")
}
